{% extends "base.html" %}
{% set title = title|default(_fsdomain('Login')) %}

{% from "security/_macros.html" import render_field_with_errors, render_field, render_field_errors, render_form_errors, prop_next %}

{% block content %}
        <div class="auth-container">
            <div class="auth-card">
                <div class="auth-header">
                    <h1>{{ _fsdomain('Login') }}</h1>
                    <p>{{ _('Please enter your credentials to log in.') }}</p>
                </div>
                <div class="auth-body">
                    {% include "security/_messages.html" %}
                    <form action="{{ url_for_security('login') }}{{ prop_next() }}" method="post" name="login_user_form" class="security-form">
                        {{ login_user_form.hidden_tag() }}
                        {{ render_form_errors(login_user_form) }}

                        {% if login_user_form.email and "email" in identity_attributes %}
                        <div class="form-floating mb-3">
                            {{ login_user_form.email(class="form-control", placeholder=_('Email address')) }}
                            <label for="email">{{ _('Email address') }}</label>
                            {{ render_field_errors(login_user_form.email) }}
                        </div>
                        {% endif %}

                        {% if login_user_form.username and "username" in identity_attributes %}
                            {% if login_user_form.email and "email" in identity_attributes %}
                                <h3 class="text-center my-3" style="color: white; font-size: 1.25rem;">{{ _fsdomain("or") }}</h3>
                            {% endif %}
                            <div class="form-floating mb-3">
                                {{ login_user_form.username(class="form-control", placeholder=_('Username')) }}
                                <label for="username">{{ _('Username') }}</label>
                                {{ render_field_errors(login_user_form.username) }}
                            </div>
                        {% endif %}

                        <div class="form-floating mb-3">
                            {{ login_user_form.password(class="form-control", placeholder=_('Password')) }}
                            <label for="password">{{ _('Password') }}</label>
                            {{ render_field_errors(login_user_form.password) }}
                        </div>

                        <div class="form-check mb-3">
                            {{ login_user_form.remember(class="form-check-input") }}
                            <label class="form-check-label" for="remember">{{ _('Remember Me') }}</label>
                            {{ render_field_errors(login_user_form.remember) }}
                        </div>

                        {{ render_field_errors(login_user_form.csrf_token) }}

                        <div class="d-grid gap-2 mb-3">
                            {{ login_user_form.submit(class="btn btn-primary btn-lg bubble-effect") }}
                        </div>
                    </form>

                    {% if security.webauthn %}
                    <hr class="my-4">
                    <h2 class="text-center h5" style="color: white;">{{ _fsdomain("Use WebAuthn to Sign In") }}</h2>
                    <div class="d-grid gap-2 mb-3">
                        <form method="get" id="wan_signin_form" name="wan_signin_form">
                            <button type="submit" class="btn btn-secondary w-100 bubble-effect" formaction="{{ url_for_security('wan_signin') }}{{ prop_next() }}">
                                <i class="fas fa-fingerprint me-2"></i> {{ _fsdomain('Sign in with WebAuthn') }}
                            </button>
                        </form>
                    </div>
                    {% endif %}

                    {% if security.oauthglue %}
                    <hr class="my-4">
                    <h2 class="text-center h5" style="color: white;">{{ _fsdomain("Use Social Oauth to Sign In") }}</h2>
                    {% for provider in security.oauthglue.provider_names %}
                        <div class="d-grid gap-2 mb-3">
                            <form method="post" id="{{ provider }}_form" name="{{ provider }}_form">
                                <button type="submit" class="btn btn-info w-100 bubble-effect" formaction="{{ url_for_security('oauthstart', name=provider) }}{{ prop_next() }}">
                                    <i class="fab fa-{{ provider | lower }} me-2"></i> {{ _fsdomain('Sign in with %(provider)s', provider=provider) }}
                                </button>
                                {% if csrf_token is defined %}
                                    <input id="{{ provider }}_csrf_token" name="{{ provider }}_csrf_token" type="hidden" value="{{ csrf_token() }}">
                                {% endif %}
                            </form>
                        </div>
                    {% endfor %}
                    {% endif %}

                    <div class="footer-links">
                        {% include "security/_menu.html" %}
                    </div>
                </div>
            </div>
        </div>
        {% endblock content %}